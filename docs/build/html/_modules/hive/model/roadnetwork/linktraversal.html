
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>hive.model.roadnetwork.linktraversal &#8212; hive  documentation</title>
    <link rel="stylesheet" href="../../../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">hive  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for hive.model.roadnetwork.linktraversal</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">NamedTuple</span>

<span class="kn">from</span> <span class="nn">h3</span> <span class="kn">import</span> <span class="n">h3</span>

<span class="kn">from</span> <span class="nn">hive.model.roadnetwork.link</span> <span class="kn">import</span> <span class="n">Link</span>
<span class="kn">from</span> <span class="nn">hive.model.roadnetwork.property_link</span> <span class="kn">import</span> <span class="n">PropertyLink</span>
<span class="kn">from</span> <span class="nn">hive.model.roadnetwork.roadnetwork</span> <span class="kn">import</span> <span class="n">RoadNetwork</span>
<span class="kn">from</span> <span class="nn">hive.util.helpers</span> <span class="kn">import</span> <span class="n">H3Ops</span>
<span class="kn">from</span> <span class="nn">hive.util.units</span> <span class="kn">import</span> <span class="n">unit</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">km</span>


<div class="viewcode-block" id="LinkTraversal"><a class="viewcode-back" href="../../../../reference/hive.model.roadnetwork.html#hive.model.roadnetwork.linktraversal.LinkTraversal">[docs]</a><span class="k">class</span> <span class="nc">LinkTraversal</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    represents the traversal of a link.</span>
<span class="sd">    traversed_link represents any part of the link that was traversed.</span>
<span class="sd">    remaining_link represents any part of the link that remains to be traversed</span>
<span class="sd">    remaining_time represents any time the agent has left to traverse additional links</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">traversed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PropertyLink</span><span class="p">]</span>
    <span class="n">remaining</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PropertyLink</span><span class="p">]</span>
    <span class="n">remaining_time</span><span class="p">:</span> <span class="n">h</span></div>


<div class="viewcode-block" id="traverse_up_to"><a class="viewcode-back" href="../../../../reference/hive.model.roadnetwork.html#hive.model.roadnetwork.linktraversal.traverse_up_to">[docs]</a><span class="k">def</span> <span class="nf">traverse_up_to</span><span class="p">(</span><span class="n">road_network</span><span class="p">:</span> <span class="n">RoadNetwork</span><span class="p">,</span>
                   <span class="n">property_link</span><span class="p">:</span> <span class="n">PropertyLink</span><span class="p">,</span>
                   <span class="n">available_time</span><span class="p">:</span> <span class="n">h</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">LinkTraversal</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    using the ground truth road network, and some agent Link traversal, attempt to traverse</span>
<span class="sd">    the link, based on travel time calculations from the Link&#39;s PropertyLink attributes.</span>
<span class="sd">    :param road_network: the road network</span>
<span class="sd">    :param property_link: the plan the agent has to traverse a subset of a road network link</span>
<span class="sd">    :param available_time: the remaining time the agent has in this time step</span>
<span class="sd">    :return: the updated traversal, or, an exception.</span>
<span class="sd">             on update, if there is any remaining traversal, return an updated Link.</span>
<span class="sd">             if no traversal remains, return None.</span>
<span class="sd">             regardless, return the agent&#39;s remaining time after traversing</span>
<span class="sd">             if there was any error, return the exception instead.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">property_link</span> <span class="o">=</span> <span class="n">road_network</span><span class="o">.</span><span class="n">get_current_property_link</span><span class="p">(</span><span class="n">property_link</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">property_link</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;attempting to traverse link </span><span class="si">{property_link.link_id}</span><span class="s2"> which does not exist&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">property_link</span><span class="o">.</span><span class="n">start</span> <span class="o">==</span> <span class="n">property_link</span><span class="o">.</span><span class="n">end</span><span class="p">:</span>
        <span class="c1"># already done!</span>
        <span class="k">return</span> <span class="n">LinkTraversal</span><span class="p">(</span>
            <span class="n">traversed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">remaining</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">remaining_time</span><span class="o">=</span><span class="n">available_time</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># traverse up to available_time across this link</span>
        <span class="k">if</span> <span class="n">property_link</span><span class="o">.</span><span class="n">travel_time</span> <span class="o">&lt;=</span> <span class="n">available_time</span><span class="p">:</span>
            <span class="c1"># we can complete this link, so we return (remaining) Link = None</span>
            <span class="k">return</span> <span class="n">LinkTraversal</span><span class="p">(</span>
                <span class="n">traversed</span><span class="o">=</span><span class="n">property_link</span><span class="p">,</span>
                <span class="n">remaining</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">remaining_time</span><span class="o">=</span><span class="n">available_time</span> <span class="o">-</span> <span class="n">property_link</span><span class="o">.</span><span class="n">travel_time</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># we do not have enough time to finish traversing this link, so, just traverse part of it,</span>
            <span class="c1"># leaving no remaining time.</span>

            <span class="c1"># find the point in this link to split into two sub-links</span>
            <span class="n">mid_geoid</span> <span class="o">=</span> <span class="n">H3Ops</span><span class="o">.</span><span class="n">point_along_link</span><span class="p">(</span><span class="n">property_link</span><span class="p">,</span> <span class="n">available_time</span><span class="p">)</span>

            <span class="c1"># create two sub-links, one for the part that was traversed, and one for the remaining part</span>
            <span class="n">traversed</span> <span class="o">=</span> <span class="n">property_link</span><span class="o">.</span><span class="n">update_link</span><span class="p">(</span><span class="n">Link</span><span class="p">(</span><span class="n">property_link</span><span class="o">.</span><span class="n">link_id</span><span class="p">,</span> <span class="n">property_link</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">mid_geoid</span><span class="p">))</span>
            <span class="n">remaining</span> <span class="o">=</span> <span class="n">property_link</span><span class="o">.</span><span class="n">update_link</span><span class="p">(</span><span class="n">Link</span><span class="p">(</span><span class="n">property_link</span><span class="o">.</span><span class="n">link_id</span><span class="p">,</span> <span class="n">mid_geoid</span><span class="p">,</span> <span class="n">property_link</span><span class="o">.</span><span class="n">end</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">LinkTraversal</span><span class="p">(</span>
                <span class="n">traversed</span><span class="o">=</span><span class="n">traversed</span><span class="p">,</span>
                <span class="n">remaining</span><span class="o">=</span><span class="n">remaining</span><span class="p">,</span>
                <span class="n">remaining_time</span><span class="o">=</span><span class="mi">0</span> <span class="o">*</span> <span class="n">unit</span><span class="o">.</span><span class="n">hours</span>
            <span class="p">)</span></div>

</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">hive  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, Brennan Borlaug, Nicholas Reinicke, Matt Moniot, Jacob Holden, Clement Rames.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.3.0.
    </div>
  </body>
</html>